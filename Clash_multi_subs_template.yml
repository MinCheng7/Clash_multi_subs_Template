# Clash å¤šè®¢é˜…çš„é…ç½®æ¨¡æ¿
# ç”Ÿæˆæ—¶é—´ï¼š2025å¹´3æœˆ20æ—¥
# ä½œè€…ï¼šMinCheng7, https://github.com/MinCheng7
# å‚è€ƒæ¥æº1ï¼šChristine, https://blog.tyasaka.xyz/posts/clash-vergerev-to-portable
# å‚è€ƒæ¥æº2ï¼šMetaCubeXè™šç©ºç»ˆç«¯å¿«æ·é…ç½®, https://wiki.metacubex.one/example/conf/#__tabbed_1_1
# ç«¯å£é…ç½®
mixed-port: 7890
allow-lan: true
mode: rule
log-level: info
external-controller: 127.0.0.1:9090

geo-auto-update: true       # è‡ªåŠ¨æ›´æ–°åœ°ç†æ•°æ®æ–‡ä»¶
geo-update-interval: 24     # è‡ªåŠ¨æ›´æ–°çš„é—´éš”æ—¶é—´ï¼ˆå°æ—¶ï¼‰
geox-url:
  geoip: "https://ghp.ci/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://ghp.ci/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://ghp.ci/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"
  asn: "https://ghp.ci/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/GeoLite2-ASN.mmdb"
profile:
  store-selected: true      # è®°ä½ä¸Šæ¬¡é€‰æ‹©çš„èŠ‚ç‚¹æˆ–ç­–ç•¥ç»„
  store-fake-ip: true       # è®°ä½ä¸Šæ¬¡åˆ†é…ç»™åŸŸåçš„å‡IPåœ°å€ï¼Œé¿å…é¢‘ç¹å˜åŒ–å¯¼è‡´åº”ç”¨å‡ºé”™
sniffer:
  enable: true              # å¼€å¯å—…æ¢åŠŸèƒ½
  force-dns-mapping: true   # å¼ºåˆ¶å°†å—…æ¢åˆ°çš„åŸŸåæ˜ å°„åˆ°DNSè¯·æ±‚ä¸­
  parse-pure-ip: true       # å°è¯•è§£æçº¯ IP æµé‡ï¼ŒæŸ¥çœ‹èƒŒåå¯¹åº”çš„åŸŸå
  override-destination: true    # å—…æ¢æˆåŠŸåï¼Œå°†è¿æ¥é‡å®šå‘åˆ°æ­£ç¡®çš„ç›®æ ‡åŸŸå
  sniff:
    HTTP:
      ports: [80, 8080-8880]    # å¯¹è¿™äº›ç«¯å£ä¸Šçš„HTTPæµé‡è¿›è¡Œå—…æ¢
      override-destination: true    # å¦‚æœè¯†åˆ«å‡ºåŸŸåï¼Œåˆ™æ”¹ä¸ºè®¿é—®åŸŸå
    TLS:
      ports: [443, 8443]        # å¯¹è¿™äº›ç«¯å£ä¸Šçš„HTTPSæµé‡å—…æ¢
    QUIC:
      ports: [443, 8443]        # å¯¹QUICåè®®æµé‡å—…æ¢
  force-domain:
    - "+.v2ex.com"          # å¯¹æŒ‡å®šåŸŸåå¼ºåˆ¶å¯ç”¨å—…æ¢ï¼Œå³ä½¿é»˜è®¤ä¸å—…æ¢
  skip-domain:
    - "+.mi.com"            # å¯¹æŒ‡å®šåŸŸåç¦æ­¢å—…æ¢ï¼Œé¿å…å—…æ¢è¯¯åˆ¤æˆ–å½±å“æ­£å¸¸ä½¿ç”¨

#å®šä¹‰è®¢é˜…çš„ç›¸åŒé…ç½®éƒ¨åˆ†
p: &p
  type: http
  interval: 3600
  health-check: 
    enable: true
    url: "https://www.gstatic.com/generate_204"
    interval: 600

# è®¢é˜…æºé…ç½®
proxy-providers:
  provider1:  # æœºåœº1çš„åç§°ï¼Œå¯è‡ªå®šä¹‰
    <<: *p  # ä½¿ç”¨å®šä¹‰p
    url: 'xxxxxx' # æœºåœºè®¢é˜…é“¾æ¥
    path: ./provider1.yaml  # yamlæ–‡ä»¶åç§°ï¼Œå¯è‡ªå®šä¹‰
    override:
      additional-prefix: "provider1 " # åœ¨å±äºè¯¥æœºåœºçš„èŠ‚ç‚¹å‰é¢æ·»åŠ æ–‡å­—
  provider2:
    <<: *p
    url: 'xxxxxx'
    path: ./provider2.yaml
    override:
      additional-prefix: "provider2 "
  provider3:
    <<: *p
    url: 'xxxxxx'
    path: ./provider3.yaml
    override:
      additional-prefix: "provider3 "

# å®šä¹‰ç­–ç•¥ç»„ä½¿ç”¨çš„è®¢é˜…
u: &u
  use:
    - provider1
    - provider2
    - provider3

# ä»£ç†ç»„é…ç½®ï¼Œæ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹
proxy-groups:

  - name: 'é€šç”¨'
    type: url-test
    proxies:
      - 'æ–°åŠ å¡'
      - 'æ—¥æœ¬'
      - 'éŸ©å›½'
      - 'é¦™æ¸¯'
      - 'ç¾å›½'
    url: http://www.gstatic.com/generate_204   # æµ‹è¯•åœ°å€
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://cdn.pixabay.com/photo/2020/08/19/15/04/icon-5501127_1280.png'  # å›¾æ ‡åœ°å€

  - name: 'AI'
    type: url-test
    proxies:
      - 'æ—¥æœ¬'
      - 'éŸ©å›½'
      - 'ç¾å›½'
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQY42SZMaBKzAc9eysk1v0IpcjhnAcndhtzMQ&s'

  - name: 'é¦™æ¸¯'
    type: url-test
    <<: *u
    filter: 'HK|é¦™æ¸¯|Hong Kong|HONGKONG'
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5b/Flag_of_Hong_Kong.svg/1200px-Flag_of_Hong_Kong.svg.png'

  - name: 'å°æ¹¾'
    type: url-test
    <<: *u
    filter: 'TW|å°æ¹¾|Taiwan|Tai Wan'
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://upload.wikimedia.org/wikipedia/commons/7/72/Flag_of_the_Republic_of_China.svg'

  - name: 'ç¾å›½'
    type: url-test
    <<: *u
    filter: 'US|ç¾å›½|USA'
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Flag_of_the_United_States.svg/2560px-Flag_of_the_United_States.svg.png'

  - name: 'æ¬§æ´²'
    type: url-test
    <<: *u
    filter: 'ğŸ‡¬ğŸ‡§|UK|è‹±å›½|Tur|åœŸè€³å…¶|FRG|å¾·å›½|ğŸ‡©ğŸ‡ª|è·å…°|ğŸ‡³ğŸ‡±|æ³•å›½|ğŸ‡«ğŸ‡·'
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Flag_of_Europe.svg/1920px-Flag_of_Europe.svg.png'

  - name: 'æ–°åŠ å¡'
    type: url-test
    <<: *u
    filter: 'SG|singapore|æ–°åŠ å¡|æ–°å›½'
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://upload.wikimedia.org/wikipedia/commons/4/48/Flag_of_Singapore.svg'

  - name: 'æ—¥æœ¬'
    type: url-test
    <<: *u
    filter: 'JP|æ—¥æœ¬|Japan'
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://upload.wikimedia.org/wikipedia/commons/9/9e/Flag_of_Japan.svg'

  - name: 'éŸ©å›½'
    type: url-test
    <<: *u
    filter: 'KR|éŸ©å›½|Korea'
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://upload.wikimedia.org/wikipedia/commons/0/09/Flag_of_South_Korea.svg'
  
  - name: 'å…¶ä»–èŠ‚ç‚¹'
    type: url-test
    <<: *u
    filter: '^(?!.*(å‰©ä½™|åˆ°æœŸ|US|ç¾å›½|USA|JP|æ—¥æœ¬|Japan|SG|æ–°åŠ å¡|Singapore|KR|éŸ©å›½|Korea|ğŸ‡¬ğŸ‡§|UK|è‹±å›½|Tur|åœŸè€³å…¶|FRG|å¾·å›½|ğŸ‡©ğŸ‡ª|è·å…°|ğŸ‡³ğŸ‡±|æ³•å›½|ğŸ‡«ğŸ‡·|TW|å°æ¹¾|Taiwan|Tai Wan|HK|é¦™æ¸¯|Hong Kong|HONGKONG)).*$'
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQP1KuSKHCkEJ_pvlSATUBl2t3dvTnKUKqQaQ&s'
  
  - name: 'è‡ªåŠ¨é€‰æ‹©'
    type: url-test
    <<: *u
    filter: '^(?!.*(å‰©ä½™|åˆ°æœŸ)).*$'      # ç§»é™¤æœºåœºçš„è¯´æ˜æ€§èŠ‚ç‚¹
    url: http://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
    max-failed-times: 5
    icon: 'https://images.icon-icons.com/910/PNG/512/rotating_icon-icons.com_71105.png'

rule-providers:
  115ç½‘ç›˜:
    type: http
    behavior: classical
    url: "https://rule.kelee.one/Clash/115.yaml"  # è§„åˆ™æ–‡ä»¶åœ°å€
    interval: 86400                        # æ›´æ–°é—´éš”ï¼ˆç§’ï¼‰
    path: ./rules/115.yaml              # æœ¬åœ°ä¿å­˜è·¯å¾„
  
  OpenAI:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml"
    interval: 86400
    path: ./rules/openai.yaml
  
  YouTube:
    type: http
    behavior: classical
    url: "https://rule.kelee.one/Clash/YouTube.yaml"
    interval: 86400
    path: ./rules/youtube.yaml
  
  Telegram:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml"
    interval: 86400
    path: ./rules/telegram.yaml

  clash_DIRECT:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/MinCheng7/SkyRules/refs/heads/main/clash_DIRECT"
    interval: 86400
    path: ./rules/clash_DIRECT.yaml

  clash_REJECT:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/MinCheng7/SkyRules/refs/heads/main/clash_REJECT"
    interval: 86400
    path: ./rules/clash_REJECT.yaml
  
  NoAdLite:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/AdvertisingLite/AdvertisingLite.yaml"
    interval: 86400
    path: ./rules/NoAdLite.yaml

  Wikipedia:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Wikipedia/Wikipedia.yaml"
    interval: 86400
    path: ./rules/Wikipedia.yaml
    

# è§„åˆ™é…ç½®
rules:
  - RULE-SET,NoAdLite,REJECT
  - RULE-SET,clash_REJECT,REJECT
  - RULE-SET,clash_DIRECT,DIRECT
  - RULE-SET,OpenAI,AI
  - DOMAIN-SUFFIX,images.steamusercontent.com,é€šç”¨
  - DOMAIN-SUFFIX,avatars.fastly.steamstatic.com,é€šç”¨
  - DOMAIN-SUFFIX,steamcommunity-a.akamaihd.net,é€šç”¨
  - DOMAIN-SUFFIX,store.steampowered.com,é€šç”¨
  - DOMAIN-SUFFIX,steam-chat.com,é€šç”¨
  - RULE-SET,Telegram,é€šç”¨
  - RULE-SET,YouTube,é€šç”¨
  - RULE-SET,Wikipedia,é€šç”¨
  - RULE-SET,115ç½‘ç›˜,DIRECT
  # ä¸­å›½ç«™ç‚¹ç›´è¿
  - GEOSITE,CN,DIRECT
  - GEOIP,CN,DIRECT
  # é»˜è®¤è§„åˆ™
  - MATCH,è‡ªåŠ¨é€‰æ‹©
